apiVersion: apps/v1
kind: Deployment
metadata:
  name: github-runner
  labels:
    app: github-runner
spec:
  replicas: 1
  selector:
    matchLabels:
      app: github-runner
  template:
    metadata:
      labels:
        app: github-runner
    spec:
      containers:
        - name: runner
      resources:
        limits:
          cpu: "2" # 2 CPUs
          memory: "4Gi" # 4 GiB RAM (note the 'Gi', not 'gb')
        requests:
          cpu: "500m" # request 0.5 CPU (optional, but recommended)
          memory: "1Gi" # request 1 GiB RAM (optional)
          image: ghcr.io/actions/runner:latest
          env:
            - name: RUNNER_TOKEN
              valueFrom:
                secretKeyRef:
                  name: github-runner-secret
                  key: runner_token
            - name: RUNNER_REPO
              value: "vercevo" # or just org for org runner
            - name: raspberry-pi
              value: "runner-$(POD_NAME)"
            - name: RUNNER_LABELS
              value: "self-hosted,kubernetes"
            - name: RUNNER_WORKDIR
              value: "/tmp/github-runner"
          volumeMounts:
            - name: workdir
              mountPath: /tmp/github-runner
      volumes:
        - name: workdir
          emptyDir: {}
